<!-- Feature Cards Section (Above the Fold) -->
<% if user_signed_in? %>
  <div class="grid md:grid-cols-2 gap-6 mb-8" data-navbar-target="searchSection">
    <!-- Deep Analysis Card -->
    <div class="bg-gradient-to-br from-purple-50 to-blue-50 rounded-xl shadow-lg border-2 border-purple-200 p-6 hover:shadow-xl transition-shadow">
      <div class="flex items-start gap-4 mb-4">
        <div class="flex-shrink-0 w-12 h-12 bg-purple-600 rounded-lg flex items-center justify-center">
          <%= heroicon "document-text", variant: :outline, options: { class: "w-7 h-7 text-white" } %>
        </div>
        <div class="flex-1">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Deep Analysis</h2>
          <p class="text-gray-700 mb-4">
            Comprehensive AI-powered analysis of any GitHub repository. Get insights on code quality, maintenance, security, and adoption.
          </p>
          <%= link_to repositories_path,
            class: "inline-flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors shadow-md hover:shadow-lg" do %>
            <%= heroicon "arrow-top-right-on-square", variant: :outline, options: { class: "w-5 h-5" } %>
            Analyze Repository
          <% end %>
        </div>
      </div>
      <div class="flex items-center gap-4 text-sm text-purple-800 bg-purple-100 rounded-lg p-3">
        <span class="font-medium">âœ¨ Features:</span>
        <span>README Analysis</span>
        <span>â€¢</span>
        <span>Issue Tracking</span>
        <span>â€¢</span>
        <span>Security Review</span>
      </div>
    </div>

    <!-- Compare Libraries Card -->
    <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl shadow-lg border-2 border-blue-200 p-6 hover:shadow-xl transition-shadow">
      <div class="flex items-start gap-4 mb-4">
        <div class="flex-shrink-0 w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center">
          <%= heroicon "magnifying-glass", variant: :outline, options: { class: "w-7 h-7 text-white" } %>
        </div>
        <div class="flex-1">
          <h2 class="text-2xl font-bold text-gray-900 mb-2">Compare Libraries</h2>
          <p class="text-gray-700 mb-4">
            Use AI to find and compare the best open source libraries for your specific needs. Get ranked recommendations with pros and cons.
          </p>
          <%= render "shared/search_form",
            container_classes: "w-full",
            input_classes: "w-full px-4 py-3 pr-12 border-2 border-blue-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 bg-white" %>
        </div>
      </div>
      <div class="flex items-center gap-4 text-sm text-blue-800 bg-blue-100 rounded-lg p-3">
        <span class="font-medium">ðŸŽ¯ Perfect for:</span>
        <span>Library Selection</span>
        <span>â€¢</span>
        <span>Tech Stack Decisions</span>
      </div>
    </div>
  </div>
<% end %>
<!-- Filter Bar -->
<div class="mb-6 bg-white rounded-lg shadow-sm border border-gray-200 p-4">
  <%= form_with url: root_path, method: :get, class: "flex flex-wrap gap-3 items-center" do |f| %>
    <!-- Search -->
    <div class="flex-1 min-w-64">
      <%= f.text_field :search,
                   value: params[:search],
                   placeholder: "Search existing comparisons...",
                   class:
                     "w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>
    <!-- Date Range -->
    <div>
      <%= f.select :date,
               options_for_select([["All Time", ""], ["This Week", "week"], ["This Month", "month"]], params[:date]),
               {},
               class: "px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>
    <!-- Sort -->
    <div>
      <%= f.select :sort,
               options_for_select([%w[Newest newest], ["Most Popular", "popular"]], params[:sort]),
               {},
               class: "px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" %>
    </div>

    <%= f.submit "Apply Filters", class: "px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium" %>

    <% if @presenter.has_filters? %>
      <%= link_to "Clear", root_path, class: "px-4 py-2 text-gray-600 hover:text-gray-900" %>
    <% end %>
  <% end %>
</div>
<!-- Comparisons List with Infinite Scroll -->
<% if @comparisons.any? %>
  <div id="comparisons_list" class="space-y-4">
    <% @comparisons.each do |comparison| %>
      <%= render "comparison_card", comparison: comparison %>
    <% end %>
  </div>
  <!-- Pagination Controls -->
  <div id="pagination_controls" class="mt-8" data-controller="infinite-scroll">
    <% if @pagy.next %>
      <!-- Invisible trigger for infinite scroll -->
      <div data-infinite-scroll-target="trigger"></div>

      <div class="flex items-center justify-center gap-4">
        <% if @pagy.previous %>
          <%= link_to "Previous Page",
          root_path(page: @pagy.previous, search: params[:search], date: params[:date], sort: params[:sort]),
          class:
            "inline-flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors shadow-md hover:shadow-lg",
          data: {
            infinite_scroll_target: "previous",
          } %>
        <% end %>

        <%= link_to "Load More",
        root_path(page: @pagy.next, search: params[:search], date: params[:date], sort: params[:sort]),
        class:
          "inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors shadow-md hover:shadow-lg",
        data: {
          turbo_stream: true,
          infinite_scroll_target: "load",
        } %>
      </div>
    <% elsif @pagy.previous %>
      <div class="flex items-center justify-center gap-4">
        <%= link_to "Previous Page",
        root_path(page: @pagy.previous, search: params[:search], date: params[:date], sort: params[:sort]),
        class:
          "inline-flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-8 rounded-xl transition-colors shadow-md hover:shadow-lg",
        data: {
          infinite_scroll_target: "previous",
        } %>
      </div>
    <% end %>
  </div>
<% else %>
  <!-- Empty State -->
  <div class="bg-white rounded-xl shadow-sm p-12 text-center">
    <div class="text-gray-400 mb-4">
      <%= heroicon "document-text", variant: :outline, options: { class: "w-16 h-16 mx-auto" } %>
    </div>
    <h3 class="text-xl font-semibold text-gray-900 mb-2">No comparisons found</h3>
    <p class="text-gray-600 mb-6">Try adjusting your filters or search terms</p>
    <%= link_to "Clear Filters",
    root_path,
    class: "inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium" %>
  </div>
<% end %>
