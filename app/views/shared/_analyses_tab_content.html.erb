<div
  data-tabs-target="panel"
  data-tab="analyses"
  id="analyses-panel"
  role="tabpanel"
  aria-labelledby="analyses-tab"
  class="hidden"
>
  <!-- Analysis Form -->
  <% if user_signed_in? %>
    <div class="mb-6 bg-white rounded-xl shadow-sm p-6 border border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Analyze a Repository</h2>

      <%= form_with url: repositories_path, method: :get, class: "space-y-4" do |f| %>
        <div>
          <label for="query" class="block text-sm font-medium text-gray-700 mb-2">
            GitHub URL or Repository
          </label>
          <%= f.text_field :query,
            placeholder: "https://github.com/owner/repo or owner/repo",
            class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",
            required: true %>
          <p class="mt-2 text-sm text-gray-500">
            Examples: https://github.com/sidekiq/sidekiq or sidekiq/sidekiq
          </p>
        </div>

        <%= f.submit "Analyze Repository",
          class: "w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-purple-700 transition-colors cursor-pointer" %>
      <% end %>

      <p class="mt-3 text-xs text-gray-500 text-center">
        Cost: ~$0.03-0.05 per analysis
      </p>
    </div>
  <% end %>

  <!-- Recent Repositories -->
  <% if local_assigns[:repositories]&.any? %>
    <div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h2 class="text-xl font-semibold text-gray-900">Recent Repositories</h2>
      </div>

      <div class="divide-y divide-gray-200">
        <% repositories.each do |repository| %>
          <% repo = RepositoryDecorator.new(repository) %>
          <%= link_to repository_path(repo), class: "block px-6 py-4 hover:bg-gray-50 transition-colors" do %>
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h3 class="text-lg font-medium text-purple-600 hover:text-purple-700">
                  <%= repo.full_name %>
                </h3>

                <% if repo.description.present? %>
                  <p class="mt-1 text-gray-600 text-sm line-clamp-2">
                    <%= repo.description %>
                  </p>
                <% end %>

                <div class="mt-2 flex items-center gap-4 text-sm text-gray-500">
                  <span>‚≠ê <%= number_with_delimiter(repo.stargazers_count) %></span>
                  <span>üç¥ <%= number_with_delimiter(repo.forks_count) %></span>
                  <% if repo.language.present? %>
                    <span>üíª <%= repo.language_display %></span>
                  <% end %>
                  <% if repo.analyses.any? %>
                    <span class="text-green-600">
                      ‚úì <%= pluralize(repo.analyses.count, 'analysis', 'analyses') %>
                    </span>
                  <% end %>
                </div>
              </div>

              <%= heroicon "chevron-right", variant: :outline, options: { class: "w-5 h-5 text-gray-400 flex-shrink-0" } %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-xl shadow-sm p-12 text-center border-2 border-purple-200">
      <div class="text-purple-400 mb-4">
        <%= heroicon "sparkles", variant: :solid, options: { class: "w-16 h-16 mx-auto" } %>
      </div>
      <h3 class="text-2xl font-bold text-gray-900 mb-2">No analyses yet!</h3>
      <p class="text-gray-700 mb-8 max-w-lg mx-auto">
        Analyze your first repository to see AI-powered insights like code quality, maintenance status, and use cases.
      </p>

      <div class="mb-8 max-w-md mx-auto">
        <p class="text-sm font-semibold text-gray-900 mb-4 flex items-center justify-center gap-2">
          <%= heroicon "light-bulb", variant: :solid, options: { class: "w-4 h-4 text-yellow-500" } %>
          Popular repositories to analyze:
        </p>

        <div class="grid grid-cols-2 gap-3">
          <% popular_repos = [
            { owner: "rails", name: "rails", description: "Ruby on Rails" },
            { owner: "sidekiq", name: "sidekiq", description: "Background jobs" },
            { owner: "nodejs", name: "node", description: "Node.js runtime" },
            { owner: "django", name: "django", description: "Python web framework" }
          ] %>
          <% popular_repos.each do |repo| %>
            <%= link_to repositories_path(query: "#{repo[:owner]}/#{repo[:name]}"),
              method: :get,
              class: "group bg-white hover:bg-purple-50 border-2 border-purple-200 hover:border-purple-400 rounded-lg p-4 transition-all shadow-sm hover:shadow-md" do %>
              <div class="text-sm font-bold text-purple-700 group-hover:text-purple-800 mb-1">
                <%= repo[:owner] %>/<%= repo[:name] %>
              </div>
              <div class="text-xs text-gray-600">
                <%= repo[:description] %>
              </div>
            <% end %>
          <% end %>
        </div>
      </div>

      <% if user_signed_in? %>
        <div class="bg-white rounded-lg p-6 max-w-md mx-auto shadow-sm mb-6">
          <p class="text-sm font-medium text-gray-700 mb-3">Or paste any GitHub URL:</p>
          <%= form_with url: repositories_path, method: :get, class: "flex gap-2" do |f| %>
            <%= f.text_field :query,
              placeholder: "github.com/owner/repo",
              class: "flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm" %>
            <%= f.submit "Analyze",
              class: "px-6 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition font-medium text-sm" %>
          <% end %>
        </div>
      <% else %>
        <%= button_to user_github_omniauth_authorize_path,
          method: :post,
          class: "inline-flex items-center gap-2 px-8 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition font-semibold shadow-lg hover:shadow-xl",
          form: { data: { turbo: false } } do %>
          Sign In to Analyze Repositories
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>
