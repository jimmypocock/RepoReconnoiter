get:
  summary: List comparisons
  description: |
    Returns a paginated list of repository comparisons with optional filtering and search.

    Supports fuzzy search across query text, technologies, problem domains, and categories.

    **Authentication:** Optional API key (bypasses rate limits)

    **Rate Limits (without API key):**
    - 100 requests/hour per IP
    - 20 requests/10 minutes per IP (burst protection)

    **With API key:** Unlimited requests
  operationId: listComparisons
  tags:
    - Comparisons
  security:
    - BearerAuth: []
    - {}  # Allow unauthenticated access (rate-limited)
  parameters:
    - name: search
      in: query
      description: Fuzzy search term (searches across query, technologies, domains, categories)
      required: false
      schema:
        type: string
        example: "rails background job"
    - name: date
      in: query
      description: Filter by date range
      required: false
      schema:
        type: string
        enum: [week, month]
        example: "week"
    - name: sort
      in: query
      description: Sort order (ignored when searching - uses relevance instead)
      required: false
      schema:
        type: string
        enum: [recent, popular]
        default: recent
    - name: page
      in: query
      description: Page number for pagination
      required: false
      schema:
        type: integer
        minimum: 1
        default: 1
        example: 1
    - name: per_page
      in: query
      description: Items per page (max 100)
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
        example: 20
  responses:
    '200':
      description: Successful response
      content:
        application/json:
          schema:
            type: object
            properties:
              data:
                type: array
                items:
                  $ref: '../schemas/Comparison.yml'
              meta:
                $ref: '../schemas/PaginationMeta.yml'
          example:
            data:
              - id: 1
                user_query: "Rails background job library with retry logic"
                normalized_query: "rails background job library with retry logic"
                technologies: "Rails, Ruby"
                problem_domains: "Background Job Processing"
                architecture_patterns: null
                repos_compared_count: 3
                recommended_repo: "sidekiq/sidekiq"
                view_count: 42
                created_at: "2025-01-15T10:30:00Z"
                updated_at: "2025-01-15T10:30:00Z"
                categories:
                  - id: 5
                    name: "Ruby"
                    category_type: "language"
                  - id: 12
                    name: "Background Jobs"
                    category_type: "problem_domain"
                repositories:
                  - id: 123
                    full_name: "sidekiq/sidekiq"
                    description: "Simple, efficient background processing for Ruby"
                    stargazers_count: 13000
                    language: "Ruby"
                    html_url: "https://github.com/sidekiq/sidekiq"
            meta:
              pagination:
                page: 1
                per_page: 20
                total_pages: 5
                total_count: 95
                next_page: 2
                prev_page: null
    '400':
      description: Bad request (invalid parameters)
      content:
        application/json:
          schema:
            $ref: '../schemas/Error.yml'
          example:
            error:
              message: "Invalid request parameters"
              details: ["per_page must be between 1 and 100"]
    '429':
      description: Rate limit exceeded (too many requests)
      headers:
        Retry-After:
          description: Number of seconds to wait before retrying
          schema:
            type: integer
            example: 3456
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: object
                properties:
                  message:
                    type: string
                    description: Human-readable error message
                  retry_after:
                    type: integer
                    description: Seconds until rate limit resets
          example:
            error:
              message: "API rate limit exceeded. Try again later."
              retry_after: 3456
    '500':
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '../schemas/Error.yml'
